{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { useState, useCallback, useEffect } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport { GiftedChat, InputToolbar, Composer, Send, Bubble } from 'react-native-gifted-chat';\nimport messageApi from \"../api/messageApi\";\nimport { MaterialIcons } from '@expo/vector-icons';\nimport userApi from \"../api/userApi\";\nimport CustomMessage from \"./CustomMessage\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar SendMessageScreen = function SendMessageScreen(_ref) {\n  var route = _ref.route;\n  var _route$params = route.params,\n    senderId = _route$params.senderId,\n    receiverId = _route$params.receiverId;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    messages = _useState2[0],\n    setMessages = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    receiver = _useState4[0],\n    setReceiver = _useState4[1];\n  useEffect(function () {\n    var loadMessageHistory = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        try {\n          var receiverInfo = yield userApi.getUserInfo(receiverId);\n          setReceiver(receiverInfo);\n          var history = yield messageApi.getThread(senderId, receiverId);\n          var formattedHistory = history.map(function (msg) {\n            return {\n              _id: msg._id,\n              text: msg.text,\n              createdAt: new Date(msg.createdAt),\n              user: {\n                _id: msg.sender,\n                name: msg.sender.username,\n                avatar: msg.sender\n              },\n              position: msg.sender === senderId ? 'right' : 'left'\n            };\n          });\n          setMessages(formattedHistory.reverse());\n        } catch (error) {\n          console.error('Error loading message history:', error);\n        }\n      });\n      return function loadMessageHistory() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    loadMessageHistory();\n  }, [senderId, receiverId]);\n  var onSend = useCallback(_asyncToGenerator(function* () {\n    var newMessages = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var message = newMessages[0];\n    try {\n      yield messageApi.sendMessage({\n        sender: senderId,\n        receiver: receiverId,\n        text: message.text\n      });\n      setMessages(function (previousMessages) {\n        return GiftedChat.append(previousMessages, newMessages);\n      });\n    } catch (error) {\n      console.error('Error sending message:', error);\n    }\n  }), [senderId, receiverId]);\n  var renderSend = function renderSend(props) {\n    return _jsx(Send, _objectSpread(_objectSpread({}, props), {}, {\n      children: _jsx(View, {\n        style: styles.sendButton,\n        children: _jsx(MaterialIcons, {\n          name: \"send\",\n          size: 24,\n          color: \"white\"\n        })\n      })\n    }));\n  };\n  return _jsxs(View, {\n    style: styles.container,\n    children: [receiver && _jsxs(View, {\n      style: styles.receiverContainer,\n      children: [_jsx(Image, {\n        source: {\n          uri: receiver.profilePic\n        },\n        style: styles.profilePic\n      }), _jsx(Text, {\n        children: receiver.username\n      })]\n    }), _jsx(GiftedChat, {\n      messages: messages,\n      onSend: onSend,\n      user: {\n        _id: senderId\n      },\n      renderInputToolbar: function renderInputToolbar(props) {\n        return _jsx(InputToolbar, _objectSpread(_objectSpread({}, props), {}, {\n          containerStyle: {\n            backgroundColor: 'white'\n          }\n        }));\n      },\n      renderComposer: function renderComposer(props) {\n        return _jsx(Composer, _objectSpread(_objectSpread({}, props), {}, {\n          textInputStyle: {\n            color: 'black',\n            backgroundColor: 'white'\n          },\n          placeholder: \"Type a message...\"\n        }));\n      },\n      renderSend: renderSend,\n      renderMessage: function renderMessage(props) {\n        return _jsx(CustomMessage, _objectSpread({}, props));\n      },\n      parsePatterns: function parsePatterns(linkStyle) {\n        return [{\n          pattern: /#(\\w+)/,\n          style: {\n            color: 'orange',\n            textDecorationLine: 'underline'\n          },\n          onPress: function onPress(props) {\n            return alert(`Pressed on hashtag: ${props.text}`);\n          }\n        }];\n      },\n      timeFormat: \"LT\"\n    })]\n  });\n};\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  },\n  sendButton: {\n    marginRight: 10,\n    marginBottom: 5,\n    backgroundColor: '#007AFF',\n    borderRadius: 5,\n    paddingVertical: 5,\n    paddingHorizontal: 10\n  },\n  receiverContainer: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    padding: 10,\n    borderBottomWidth: 1,\n    borderBottomColor: '#ccc'\n  },\n  profilePic: {\n    width: 50,\n    height: 50,\n    borderRadius: 25,\n    marginRight: 10\n  }\n});\nexport default SendMessageScreen;","map":{"version":3,"names":["React","useState","useCallback","useEffect","View","StyleSheet","Text","Image","GiftedChat","InputToolbar","Composer","Send","Bubble","messageApi","MaterialIcons","userApi","CustomMessage","jsx","_jsx","jsxs","_jsxs","SendMessageScreen","_ref","route","_route$params","params","senderId","receiverId","_useState","_useState2","_slicedToArray","messages","setMessages","_useState3","_useState4","receiver","setReceiver","loadMessageHistory","_ref2","_asyncToGenerator","receiverInfo","getUserInfo","history","getThread","formattedHistory","map","msg","_id","text","createdAt","Date","user","sender","name","username","avatar","position","reverse","error","console","apply","arguments","onSend","newMessages","length","undefined","message","sendMessage","previousMessages","append","renderSend","props","_objectSpread","children","style","styles","sendButton","size","color","container","receiverContainer","source","uri","profilePic","renderInputToolbar","containerStyle","backgroundColor","renderComposer","textInputStyle","placeholder","renderMessage","parsePatterns","linkStyle","pattern","textDecorationLine","onPress","alert","timeFormat","create","flex","marginRight","marginBottom","borderRadius","paddingVertical","paddingHorizontal","flexDirection","alignItems","padding","borderBottomWidth","borderBottomColor","width","height"],"sources":["C:/Users/dyarb/batcave/Meetup_2.0/client/components/SendMessageScreen.js"],"sourcesContent":["import React, { useState, useCallback, useEffect } from 'react';\r\nimport { View, StyleSheet, Text, Image } from 'react-native';\r\nimport { GiftedChat, InputToolbar, Composer, Send, Bubble } from 'react-native-gifted-chat';\r\nimport messageApi from '../api/messageApi';\r\nimport { MaterialIcons } from '@expo/vector-icons'; // Import the desired icon library\r\nimport userApi from '../api/userApi';\r\nimport CustomMessage from './CustomMessage'; // Import the CustomMessage component\r\n\r\nconst SendMessageScreen = ({ route }) => {\r\n  const { senderId, receiverId } = route.params;\r\n  const [messages, setMessages] = useState([]);\r\n  const [receiver, setReceiver] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const loadMessageHistory = async () => {\r\n      try {\r\n        const receiverInfo = await userApi.getUserInfo(receiverId);\r\n        setReceiver(receiverInfo);\r\n        const history = await messageApi.getThread(senderId, receiverId);\r\n        const formattedHistory = history.map((msg) => ({\r\n          _id: msg._id,\r\n          text: msg.text,\r\n          createdAt: new Date(msg.createdAt),\r\n          user: {\r\n            _id: msg.sender,\r\n            name: msg.sender.username,\r\n            avatar: msg.sender\r\n          },\r\n          position: msg.sender === senderId ? 'right' : 'left',\r\n        }));\r\n\r\n        setMessages(formattedHistory.reverse());\r\n      } catch (error) {\r\n        console.error('Error loading message history:', error);\r\n      }\r\n    };\r\n\r\n    loadMessageHistory();\r\n  }, [senderId, receiverId]);\r\n\r\n  const onSend = useCallback(async (newMessages = []) => {\r\n    const message = newMessages[0];\r\n    try {\r\n      await messageApi.sendMessage({\r\n        sender: senderId,\r\n        receiver: receiverId,\r\n        text: message.text,\r\n      });\r\n\r\n      setMessages((previousMessages) => GiftedChat.append(previousMessages, newMessages));\r\n    } catch (error) {\r\n      console.error('Error sending message:', error);\r\n    }\r\n  }, [senderId, receiverId]);\r\n\r\n  const renderSend = (props) => (\r\n    <Send {...props}>\r\n      <View style={styles.sendButton}>\r\n        <MaterialIcons name=\"send\" size={24} color=\"white\" />\r\n      </View>\r\n    </Send>\r\n  );\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      {receiver && (\r\n        <View style={styles.receiverContainer}>\r\n          <Image source={{ uri: receiver.profilePic }} style={styles.profilePic} />\r\n          <Text>{receiver.username}</Text>\r\n        </View>\r\n      )}\r\n      <GiftedChat\r\n        messages={messages}\r\n        onSend={onSend}\r\n        user={{\r\n          _id: senderId,\r\n        }}\r\n        renderInputToolbar={(props) => (\r\n          <InputToolbar\r\n            {...props}\r\n            containerStyle={{ backgroundColor: 'white' }}\r\n          />\r\n        )}\r\n        renderComposer={(props) => (\r\n          <Composer\r\n            {...props}\r\n            textInputStyle={{ color: 'black', backgroundColor: 'white' }}\r\n            placeholder=\"Type a message...\"\r\n          />\r\n        )}\r\n        renderSend={renderSend}\r\n        renderMessage={(props) => <CustomMessage {...props} />} // Use CustomMessage here\r\n        parsePatterns={(linkStyle) => [\r\n          {\r\n            pattern: /#(\\w+)/,\r\n            style: { color: 'orange', textDecorationLine: 'underline' },\r\n            onPress: (props) => alert(`Pressed on hashtag: ${props.text}`),\r\n          },\r\n        ]}\r\n        timeFormat='LT'\r\n      />\r\n    </View>\r\n  );\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n  },\r\n  sendButton: {\r\n    marginRight: 10,\r\n    marginBottom: 5,\r\n    backgroundColor: '#007AFF',\r\n    borderRadius: 5,\r\n    paddingVertical: 5,\r\n    paddingHorizontal: 10,\r\n  },\r\n  receiverContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    padding: 10,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#ccc',\r\n  },\r\n  profilePic: {\r\n    width: 50,\r\n    height: 50,\r\n    borderRadius: 25,\r\n    marginRight: 10,\r\n  },\r\n});\r\n\r\nexport default SendMessageScreen;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}